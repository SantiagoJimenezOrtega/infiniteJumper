(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();const M={GRAVITY:.6,FRICTION:.8,AIR_RESISTANCE:.99,TERMINAL_VELOCITY:20},b={SIZE:30,MAX_CHARGE:1e3,MIN_JUMP_POWER:8,JUMP_Y_RATIO:.8},k={PLATFORM_HEIGHT:20,PLATFORM_WIDTH_MIN:60,PLATFORM_WIDTH_MAX:150,SPAWN_GAP_MIN:80,SPAWN_GAP_MAX:180},A=[{height:0,name:"Forest",colorTop:"#87CEEB",colorBottom:"#90EE90"},{height:3e3,name:"Sky",colorTop:"#1E90FF",colorBottom:"#87CEEB"},{height:6500,name:"Space",colorTop:"#000000",colorBottom:"#4B0082"}],W=[{id:"frog",name:"Rana",emoji:"ðŸ¸",price:0,color:"#44ff44",stats:{jumpForce:18,jumpAngleX:.6,gravity:.6,chargeSpeed:1},description:"Equilibrada. Perfecta para empezar."},{id:"rabbit",name:"Conejo",emoji:"ðŸ‡",price:150,color:"#ffffff",stats:{jumpForce:16,jumpAngleX:.9,gravity:.7,chargeSpeed:1.5},description:"RÃ¡pido y Ã¡gil. Salta lejos."},{id:"flea",name:"Pulga",emoji:"ðŸœ",price:300,color:"#cc6600",stats:{jumpForce:24,jumpAngleX:.3,gravity:.5,chargeSpeed:3},description:"Saltos explosivos y verticales."},{id:"goat",name:"Cabra",emoji:"ðŸ",price:500,color:"#aaaaaa",stats:{jumpForce:19,jumpAngleX:.7,gravity:.9,chargeSpeed:.8},description:"Maestra de la escalada. CaÃ­da precisa."},{id:"grasshopper",name:"Saltamontes",emoji:"ðŸ¦—",price:800,color:"#00cc00",stats:{jumpForce:22,jumpAngleX:1,gravity:.5,chargeSpeed:1.2},description:"Se lanza a grandes distancias."}];class U{constructor(e){this.game=e,this.width=b.SIZE,this.height=b.SIZE,this.x=e.width/2-this.width/2,this.y=e.height-300,this.vx=0,this.vy=0,this.grounded=!1;const t=localStorage.getItem("equippedAnimal")||"frog",i=W.find(s=>s.id===t)||W[0];this.color=i.color,this.emoji=i.emoji,this.stats=i.stats,this.currentSurface="normal",this.bulletTime=!1,this.bulletTimeEnd=0,this.jumpCancelled=!1,this.jumpCount=0,this.facing=1,this.comboCount=0,this.lastLandTime=0,this.hasLanded=!1,this.animationFrame=0,this.animationTimer=0,this.animationSpeed=.1}update(e){const t=this.game.input;t.keys.ArrowLeft.pressed&&(this.facing=-1),t.keys.ArrowRight.pressed&&(this.facing=1),this.bulletTime&&performance.now()>this.bulletTimeEnd&&(this.bulletTime=!1),this.grounded?(this.currentSurface==="ice"?this.vx*=.88:this.vx*=M.FRICTION,t.keys.ArrowDown.pressed&&(this.jumpCancelled=!0),t.keys.ArrowUp.justReleased?(this.jumpCancelled||this.jump(0,t.keys.ArrowUp.duration),this.jumpCancelled=!1,t.keys.ArrowUp.justReleased=!1):t.keys.ArrowLeft.justReleased?(this.jumpCancelled||this.jump(-1,t.keys.ArrowLeft.duration),this.jumpCancelled=!1,t.keys.ArrowLeft.justReleased=!1):t.keys.ArrowRight.justReleased&&(this.jumpCancelled||this.jump(1,t.keys.ArrowRight.duration),this.jumpCancelled=!1,t.keys.ArrowRight.justReleased=!1)):(this.vx*=M.AIR_RESISTANCE,this.bulletTime||(t.keys.ArrowLeft.pressed?this.vx-=.2:t.keys.ArrowRight.pressed&&(this.vx+=.2)),this.bulletTime&&(t.keys.ArrowUp.justReleased?(this.jump(0,t.keys.ArrowUp.duration),this.bulletTime=!1,t.keys.ArrowUp.justReleased=!1):t.keys.ArrowLeft.justReleased?(this.jump(-1,t.keys.ArrowLeft.duration),this.bulletTime=!1,t.keys.ArrowLeft.justReleased=!1):t.keys.ArrowRight.justReleased&&(this.jump(1,t.keys.ArrowRight.duration),this.bulletTime=!1,t.keys.ArrowRight.justReleased=!1)));const i=this.game.world.wind*this.game.world.windStrength;this.grounded?this.currentSurface==="ice"?this.vx+=i*.8:this.vx+=i*.1:this.vx+=i*.4,this.vy+=M.GRAVITY*this.stats.gravity,this.vy>M.TERMINAL_VELOCITY&&(this.vy=M.TERMINAL_VELOCITY),this.x+=this.vx,this.y+=this.vy,this.x<0&&(this.x=0,this.vx*=-.5),this.x+this.width>this.game.width&&(this.x=this.game.width-this.width,this.vx*=-.5),this.grounded=!1,this.checkPlatformCollisions()}jump(e,t){const i=performance.now();if(this.lastJumpTime&&i-this.lastJumpTime<250)return;this.lastJumpTime=i,this.jumpCount++;let a=Math.min(t*this.stats.chargeSpeed,b.MAX_CHARGE)/b.MAX_CHARGE;a=Math.pow(a,.8);const r=b.MIN_JUMP_POWER,n=this.stats.jumpForce,l=r+(n-r)*a;e!==0?(this.vx=e*l*this.stats.jumpAngleX,this.vy=-l*b.JUMP_Y_RATIO,this.facing=e):(this.vx=0,this.vy=-l*1.2),this.grounded=!1,this.hasLanded=!1,this.game.particles.spawn(this.x+this.width/2,this.y+this.height,"#ffffff",10),this.game.soundManager.playJump()}checkPlatformCollisions(){if(!(this.vy<0)){for(const e of this.game.world.platforms)if(e.active&&this.x<e.x+e.width&&this.x+this.width>e.x&&this.y+this.height>e.y-5&&this.y+this.height<e.y+e.height+this.vy+10){if(this.vy>0){if(this.y=e.y-this.height,!this.hasLanded){const t=performance.now();t-this.lastLandTime<1500?(this.comboCount++,this.comboCount>1&&this.game.showComboPopup(this.comboCount,this.x,this.y)):this.comboCount=1,this.lastLandTime=t,this.hasLanded=!0}this.grounded=!0}this.game.particles.spawn(this.x+this.width/2,this.y+this.height,"#ffffff",1),e.type==="blue"?this.currentSurface="ice":e.type==="pink"?(this.vy=-15,this.grounded=!1,this.bulletTime=!0,this.bulletTimeEnd=performance.now()+3e3,this.game.particles.spawn(this.x+this.width/2,this.y+this.height,"#ff00cc",20),this.game.soundManager.playBounce()):e.type==="red"?(this.currentSurface="normal",e.timer===0&&(e.timer=performance.now()+2e3,this.game.soundManager.playExplosion())):e.type==="brown"&&(this.currentSurface="normal");return}}}draw(e){const t=this.game.input;let i=0,s=!1;if(t.keys.ArrowLeft.pressed?(i=t.getCharge("ArrowLeft"),s=!0):t.keys.ArrowRight.pressed?(i=t.getCharge("ArrowRight"),s=!0):t.keys.ArrowUp.pressed&&(i=t.getCharge("ArrowUp"),s=!0),s&&this.grounded&&!this.jumpCancelled){const n=this.x+this.width/2-30,l=this.y-20,c=Math.min(i*this.stats.chargeSpeed,b.MAX_CHARGE),p=c/b.MAX_CHARGE;e.fillStyle="rgba(0, 0, 0, 0.5)",e.fillRect(n,l,60,8);const h=c>=b.MAX_CHARGE;if(e.fillStyle=h?"#ff0000":"#00ffcc",h){const f=Math.sin(Date.now()/100)*.3+.7;e.globalAlpha=f,e.shadowBlur=15,e.shadowColor="#ff0000"}e.fillRect(n,l,60*p,8),e.shadowBlur=0,e.globalAlpha=1,e.strokeStyle="#ffffff",e.lineWidth=1,e.strokeRect(n,l,60,8)}if(this.bulletTime){const a=(this.bulletTimeEnd-performance.now())/1e3,r=Math.sin(Date.now()/100)*.5+.5;e.shadowBlur=20+r*10,e.shadowColor="#ff00cc",e.save(),e.font="bold 14px Inter, sans-serif",e.fillStyle="#ff00cc",e.textAlign="center",e.shadowBlur=10,e.fillText(`âš¡ ${a.toFixed(1)}s`,this.x+this.width/2,this.y-30),e.restore()}this.animationTimer+=.1,this.animationTimer>=this.animationSpeed&&(this.animationFrame=(this.animationFrame+1)%4,this.animationTimer=0),e.save(),e.translate(this.x+this.width/2,this.y+this.height/2),this.facing===-1&&e.scale(-1,1),this.drawSprite(e),e.restore(),e.shadowBlur=0}drawSprite(e){const t=this.width,i=!this.grounded;switch(this.emoji){case"ðŸ¸":this.drawFrog(e,t,i);break;case"ðŸ°":this.drawRabbit(e,t,i);break;case"ðŸ¿ï¸":this.drawSquirrel(e,t,i);break;case"ðŸ¦˜":this.drawKangaroo(e,t,i);break;case"ðŸ±":this.drawCat(e,t,i);break;case"ðŸ¦…":this.drawEagle(e,t,i);break;default:e.font=`${t*1.2}px serif`,e.textAlign="center",e.textBaseline="middle",e.fillStyle="#ffffff",e.fillText(this.emoji,0,5)}}drawFrog(e,t,i){e.fillStyle="#4CAF50",e.beginPath(),e.ellipse(0,0,t*.4,t*.35,0,0,Math.PI*2),e.fill(),e.fillStyle="#FFFFFF",e.beginPath(),e.arc(-t*.15,-t*.15,t*.12,0,Math.PI*2),e.arc(t*.15,-t*.15,t*.12,0,Math.PI*2),e.fill(),e.fillStyle="#000000",e.beginPath(),e.arc(-t*.15,-t*.15,t*.06,0,Math.PI*2),e.arc(t*.15,-t*.15,t*.06,0,Math.PI*2),e.fill(),i&&(e.strokeStyle="#4CAF50",e.lineWidth=t*.1,e.beginPath(),e.moveTo(-t*.2,t*.2),e.lineTo(-t*.3,t*.5),e.moveTo(t*.2,t*.2),e.lineTo(t*.3,t*.5),e.stroke())}drawRabbit(e,t,i){e.fillStyle="#FFB6C1",e.beginPath(),e.ellipse(-t*.15,-t*.4,t*.08,t*.25,-.3,0,Math.PI*2),e.ellipse(t*.15,-t*.4,t*.08,t*.25,.3,0,Math.PI*2),e.fill(),e.fillStyle="#FFFFFF",e.beginPath(),e.ellipse(0,0,t*.35,t*.4,0,0,Math.PI*2),e.fill(),e.fillStyle="#000000",e.beginPath(),e.arc(-t*.12,-t*.05,t*.05,0,Math.PI*2),e.arc(t*.12,-t*.05,t*.05,0,Math.PI*2),e.fill(),e.fillStyle="#FFB6C1",e.beginPath(),e.arc(0,t*.05,t*.04,0,Math.PI*2),e.fill()}drawSquirrel(e,t,i){e.fillStyle="#D2691E",e.beginPath(),e.arc(-t*.3,t*.1,t*.25,0,Math.PI*2),e.fill(),e.fillStyle="#CD853F",e.beginPath(),e.ellipse(0,0,t*.3,t*.35,0,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(0,-t*.2,t*.2,0,Math.PI*2),e.fill(),e.fillStyle="#000000",e.beginPath(),e.arc(-t*.08,-t*.22,t*.04,0,Math.PI*2),e.arc(t*.08,-t*.22,t*.04,0,Math.PI*2),e.fill()}drawKangaroo(e,t,i){const s=i?-t*.1:0;e.fillStyle="#D2691E",e.beginPath(),e.ellipse(0,s,t*.35,t*.45,0,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(0,-t*.3+s,t*.25,t*.2,0,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(-t*.12,-t*.45+s,t*.08,t*.15,-.2,0,Math.PI*2),e.ellipse(t*.12,-t*.45+s,t*.08,t*.15,.2,0,Math.PI*2),e.fill(),e.fillStyle="#000000",e.beginPath(),e.arc(-t*.08,-t*.3+s,t*.04,0,Math.PI*2),e.arc(t*.08,-t*.3+s,t*.04,0,Math.PI*2),e.fill(),i||(e.strokeStyle="#D2691E",e.lineWidth=t*.12,e.beginPath(),e.moveTo(t*.2,t*.3),e.quadraticCurveTo(t*.5,t*.4,t*.4,t*.6),e.stroke())}drawCat(e,t,i){e.fillStyle="#FF8C00",e.beginPath(),e.ellipse(0,0,t*.35,t*.3,0,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(0,-t*.15,t*.25,0,Math.PI*2),e.fill(),e.beginPath(),e.moveTo(-t*.2,-t*.3),e.lineTo(-t*.25,-t*.45),e.lineTo(-t*.1,-t*.35),e.fill(),e.beginPath(),e.moveTo(t*.2,-t*.3),e.lineTo(t*.25,-t*.45),e.lineTo(t*.1,-t*.35),e.fill(),e.fillStyle="#00FF00",e.beginPath(),e.arc(-t*.1,-t*.18,t*.06,0,Math.PI*2),e.arc(t*.1,-t*.18,t*.06,0,Math.PI*2),e.fill(),e.fillStyle="#000000",e.beginPath(),e.ellipse(-t*.1,-t*.18,t*.02,t*.04,0,0,Math.PI*2),e.ellipse(t*.1,-t*.18,t*.02,t*.04,0,0,Math.PI*2),e.fill()}drawEagle(e,t,i){const s=i?Math.sin(this.animationFrame*Math.PI)*.3:0;e.fillStyle="#8B4513",e.beginPath(),e.ellipse(0,0,t*.25,t*.35,0,0,Math.PI*2),e.fill(),e.fillStyle="#FFFFFF",e.beginPath(),e.arc(0,-t*.25,t*.18,0,Math.PI*2),e.fill(),e.fillStyle="#FFD700",e.beginPath(),e.moveTo(t*.1,-t*.2),e.lineTo(t*.25,-t*.2),e.lineTo(t*.1,-t*.15),e.fill(),e.fillStyle="#000000",e.beginPath(),e.arc(-t*.06,-t*.27,t*.04,0,Math.PI*2),e.arc(t*.06,-t*.27,t*.04,0,Math.PI*2),e.fill(),e.fillStyle="#8B4513",e.save(),e.rotate(s),e.beginPath(),e.ellipse(-t*.3,0,t*.15,t*.4,-.5,0,Math.PI*2),e.fill(),e.restore(),e.save(),e.rotate(-s),e.beginPath(),e.ellipse(t*.3,0,t*.15,t*.4,.5,0,Math.PI*2),e.fill(),e.restore()}}class Z{constructor(){this.keys={ArrowLeft:{pressed:!1,justReleased:!1,startTime:0},ArrowRight:{pressed:!1,justReleased:!1,startTime:0},ArrowUp:{pressed:!1,justReleased:!1,startTime:0},ArrowDown:{pressed:!1,justReleased:!1,startTime:0}},this.charge=0,this.direction=0,this.activeTouches=new Map,window.addEventListener("keydown",e=>this.onKeyDown(e)),window.addEventListener("keyup",e=>this.onKeyUp(e)),this.setupTouch()}setupTouch(){const e=t=>{const i=window.innerWidth,s=i*.35,a=i*.65;return t<s?"ArrowLeft":t>a?"ArrowRight":"ArrowUp"};window.addEventListener("touchstart",t=>{if(t.target.tagName==="BUTTON")return;t.preventDefault();const i=t.changedTouches[0],s=e(i.clientX);["ArrowLeft","ArrowRight","ArrowUp"].forEach(a=>{a!==s&&this.handleRelease(a)}),this.handlePress(s),this.activeTouches.set(i.identifier,{key:s,startY:i.clientY,startX:i.clientX})},{passive:!1}),window.addEventListener("touchmove",t=>{t.preventDefault();for(let i=0;i<t.changedTouches.length;i++){const s=t.changedTouches[i],a=this.activeTouches.get(s.identifier);a&&s.clientY-a.startY>50&&(this.handlePress("ArrowDown"),a.key&&(this.handleRelease(a.key),a.key=null))}},{passive:!1}),window.addEventListener("touchend",t=>{t.preventDefault();for(let i=0;i<t.changedTouches.length;i++){const s=t.changedTouches[i],a=this.activeTouches.get(s.identifier);a&&a.key&&this.handleRelease(a.key),this.handleRelease("ArrowDown"),this.activeTouches.delete(s.identifier)}},{passive:!1}),window.addEventListener("touchcancel",t=>{t.preventDefault(),["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].forEach(i=>this.handleRelease(i)),this.activeTouches.clear()})}handlePress(e){this.keys[e]&&!this.keys[e].pressed&&(this.keys[e].pressed=!0,this.keys[e].startTime=performance.now())}handleRelease(e){this.keys[e]&&this.keys[e].pressed&&(this.keys[e].pressed=!1,this.keys[e].justReleased=!0,this.keys[e].duration=performance.now()-this.keys[e].startTime)}onKeyDown(e){this.keys[e.code]&&this.handlePress(e.code)}onKeyUp(e){this.keys[e.code]&&this.handleRelease(e.code)}update(){Object.values(this.keys).forEach(e=>e.justReleased=!1)}get isCharging(){return this.keys.ArrowLeft.pressed||this.keys.ArrowRight.pressed||this.keys.ArrowUp.pressed}getCharge(e){return this.keys[e].pressed?performance.now()-this.keys[e].startTime:0}}class ${constructor(e,t){this.x=e,this.y=t,this.width=30,this.height=30,this.active=!0,this.floatOffset=Math.random()*Math.PI*2}update(e){this.floatOffset+=e*3}draw(e){if(!this.active)return;const t=Math.sin(this.floatOffset)*5,i=this.x+this.width/2,s=this.y+this.height/2+t;e.save(),e.fillStyle="#4CC9F0",e.shadowBlur=15,e.shadowColor="#4CC9F0",e.beginPath(),e.arc(i,s+5,8,0,Math.PI,!1),e.lineTo(i,s-10),e.closePath(),e.fill(),e.fillStyle="#ffffff",e.shadowBlur=0,e.beginPath(),e.arc(i-3,s+2,2,0,Math.PI*2),e.fill(),e.restore()}}class D{constructor(e){this.game=e,this.platforms=[],this.collectibles=[],this.highestPoint=this.game.height-50,this.wind=0,this.windTimer=0,this.windStrength=.05,this.platforms.push({x:0,y:this.game.height-20,width:this.game.width,height:20,type:"brown",active:!0}),this.generatePlatforms()}generatePlatforms(){for(;this.highestPoint>this.game.camera.y-this.game.height;){const e=k.SPAWN_GAP_MIN+Math.random()*(k.SPAWN_GAP_MAX-k.SPAWN_GAP_MIN),t=this.highestPoint-e,i=k.PLATFORM_WIDTH_MIN+Math.random()*(k.PLATFORM_WIDTH_MAX-k.PLATFORM_WIDTH_MIN),s=Math.random()*(this.game.width-i);let a="brown";const r=Math.random();if(r>.92?a="pink":r>.8?a="blue":r>.7&&(a="red"),this.platforms.push({x:s,y:t,width:i,height:k.PLATFORM_HEIGHT,type:a,active:!0,timer:0,respawnTimer:0}),Math.random()<.5){const n=s+i/2-15,l=t-40;this.collectibles.push(new $(n,l)),Math.random()<.2&&this.collectibles.push(new $(n+(Math.random()>.5?25:-25),l-15))}this.highestPoint=t}}update(){const t=Math.max(0,Math.floor((this.game.height-this.game.player.y-this.game.player.height)/10))%500;t>=300&&t<450?(this.windTimer+=.02,this.wind=Math.sin(this.windTimer)):this.wind*=.95,this.game.camera.y<this.highestPoint+this.game.height*2&&this.generatePlatforms();const s=performance.now();for(const a of this.platforms)a.type==="red"&&(a.active?a.timer>0&&s>a.timer&&(a.active=!1,a.respawnTimer=s+1e3,a.timer=0):s>a.respawnTimer&&(a.active=!0,a.timer=0));this.collectibles.forEach(a=>a.update(1/60)),this.collectibles=this.collectibles.filter(a=>a.active&&a.y<this.game.camera.y+this.game.height)}draw(e){for(const t of this.platforms){if(!t.active)continue;const i=Math.max(0,Math.floor((this.game.height-t.y)/10));let s=A[0];for(let a=A.length-1;a>=0;a--)if(i>=A[a].height){s=A[a];break}t.type==="brown"?s.name==="Sky"?e.fillStyle="#f0f8ff":s.name==="Space"?e.fillStyle="#2f4f4f":e.fillStyle="#8b4513":t.type==="pink"?e.fillStyle="#ff00cc":t.type==="blue"?e.fillStyle="#00ffff":t.type==="red"&&(e.fillStyle="#ff4444",t.timer>0&&Math.floor(Date.now()/50)%2===0&&(e.fillStyle="#ffaaaa")),e.shadowBlur=10,e.shadowColor=e.fillStyle,e.fillRect(t.x,t.y,t.width,t.height),e.strokeStyle="rgba(255,255,255,0.5)",e.lineWidth=2,e.strokeRect(t.x,t.y,t.width,t.height),e.shadowBlur=0}this.collectibles.forEach(t=>{t.active&&t.draw(e)})}}class _{constructor(e){this.game=e,this.y=0}update(){const e=this.game.player.y-this.game.height/2;this.y+=(e-this.y)*.1,this.y>0&&(this.y=0)}}class Q{constructor(e){this.game=e,this.particles=[]}spawn(e,t,i,s=10){for(let a=0;a<s;a++)this.particles.push({x:e,y:t,vx:(Math.random()-.5)*4,vy:(Math.random()-.5)*4,life:1,color:i,type:"normal"})}spawnLeaf(){this.particles.push({x:Math.random()*this.game.width,y:this.game.camera.y-10,vx:(Math.random()-.5)*2+this.game.world.wind*5,vy:Math.random()*2+1,life:2,type:"leaf",color:Math.random()>.5?"#228B22":"#DAA520",rotation:Math.random()*Math.PI*2,rotSpeed:(Math.random()-.5)*.1})}spawnCloud(){this.particles.push({x:this.game.world.wind>0?-50:this.game.width+50,y:this.game.camera.y+Math.random()*this.game.height,vx:(this.game.world.wind||.5)*2,vy:0,life:4,type:"cloud",color:"#ffffff",size:Math.random()*20+10})}spawnStar(){this.particles.push({x:Math.random()*this.game.width,y:this.game.camera.y+Math.random()*this.game.height,vx:0,vy:0,life:1.5,type:"star",color:"#ffffaa",size:Math.random()*2+1})}update(){Math.abs(this.game.world.wind)>.2&&Math.random()<.3&&this.particles.push({x:Math.random()*this.game.width,y:this.game.camera.y+Math.random()*this.game.height,vx:this.game.world.wind*15,vy:(Math.random()-.5)*2,life:1,type:"wind",color:"#ffffff"});const e=Math.max(0,Math.floor((this.game.height-this.game.player.y-this.game.player.height)/10));e<500?Math.random()<.05&&this.spawnLeaf():e<1500?Math.random()<.01&&this.spawnCloud():Math.random()<.1&&this.spawnStar();for(let t=this.particles.length-1;t>=0;t--){const i=this.particles[t];i.type==="leaf"?(i.x+=i.vx,i.y+=i.vy,i.rotation+=i.rotSpeed,i.life-=.01):i.type==="cloud"?(i.x+=i.vx,i.life-=.005):i.type==="star"?i.life-=.02:(i.x+=i.vx,i.y+=i.vy,i.life-=.03),i.life<=0&&this.particles.splice(t,1)}}draw(e){for(const t of this.particles)e.save(),e.globalAlpha=t.life,t.type==="wind"?(e.strokeStyle="rgba(255, 255, 255, 0.3)",e.lineWidth=2,e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(t.x-t.vx*3,t.y),e.stroke()):t.type==="leaf"?(e.translate(t.x,t.y),e.rotate(t.rotation),e.fillStyle=t.color,e.fillRect(-3,-3,6,6)):t.type==="cloud"?(e.fillStyle="rgba(255, 255, 255, 0.4)",e.beginPath(),e.arc(t.x,t.y,t.size,0,Math.PI*2),e.fill()):t.type==="star"?(e.fillStyle=t.color,e.shadowBlur=5,e.shadowColor="#fff",e.fillRect(t.x,t.y,t.size,t.size)):(e.fillStyle=t.color,e.shadowBlur=5,e.shadowColor=t.color,e.fillRect(t.x,t.y,4,4)),e.restore()}}class z{constructor(e){this.game=e,this.active=!0,this.screens={main:document.getElementById("main-menu"),difficulty:document.getElementById("difficulty-menu"),shop:document.getElementById("shop-menu"),victory:document.getElementById("victory-screen")},this.buttons={continue:document.getElementById("btn-continue"),newGame:document.getElementById("btn-new-game"),shop:document.getElementById("btn-shop"),diffAssisted:document.getElementById("btn-diff-assisted"),diffExtreme:document.getElementById("btn-diff-extreme"),diffBack:document.getElementById("btn-diff-back"),shopBack:document.getElementById("btn-shop-back"),victoryContinue:document.getElementById("btn-victory-continue")},this.shopGrid=document.getElementById("shop-grid"),this.shopWallet=document.getElementById("shop-wallet-amount"),this.wallet=parseInt(localStorage.getItem("walletDrops")||"0"),this.unlockedAnimals=JSON.parse(localStorage.getItem("unlockedAnimals")||'["frog"]'),this.equippedAnimal=localStorage.getItem("equippedAnimal")||"frog",this.checkSave(),this.bindEvents(),this.showScreen("main")}checkSave(){this.savedDifficulty=null,localStorage.getItem("gameState_extreme")?this.savedDifficulty="extreme":localStorage.getItem("gameState_assisted")&&(this.savedDifficulty="assisted"),this.savedDifficulty?(this.buttons.continue.style.display="block",this.buttons.continue.innerText=`CONTINUAR (${this.savedDifficulty.toUpperCase()})`):this.buttons.continue.style.display="none"}bindEvents(){const e=(t,i)=>{t&&(t.addEventListener("click",i),t.addEventListener("touchstart",s=>{s.preventDefault(),i(s)},{passive:!1}))};e(this.buttons.continue,()=>{this.hideAll(),this.game.continueGame(this.savedDifficulty)}),e(this.buttons.newGame,()=>{this.showScreen("difficulty")}),e(this.buttons.shop,()=>{this.updateShopUI(),this.showScreen("shop")}),e(this.buttons.diffAssisted,()=>{this.startGame("assisted")}),e(this.buttons.diffExtreme,()=>{this.startGame("extreme")}),e(this.buttons.diffBack,()=>{this.showScreen("main")}),e(this.buttons.shopBack,()=>{this.showScreen("main")}),e(this.buttons.victoryContinue,()=>{this.screens.victory.style.display="none",this.showScreen("main"),this.game.resetGame()})}startGame(e){this.hideAll(),this.game.startNewGame(e)}showScreen(e){Object.values(this.screens).forEach(t=>t.style.display="none"),this.screens[e]&&(this.screens[e].style.display="flex",this.active=!0),e==="main"&&this.checkSave()}hideAll(){Object.values(this.screens).forEach(e=>e.style.display="none"),this.active=!1}showVictory(){this.screens.victory.style.display="flex",this.active=!0}updateShopUI(){this.wallet=parseInt(localStorage.getItem("walletDrops")||"0"),this.shopWallet.innerText=this.wallet,this.shopGrid.innerHTML="",W.forEach(e=>{const t=this.unlockedAnimals.includes(e.id),i=this.equippedAnimal===e.id,s=this.wallet>=e.price,a=document.createElement("div");a.className=`animal-card ${i?"equipped":""}`,a.innerHTML=`
                <div class="animal-emoji">${e.emoji}</div>
                <div class="animal-name">${e.name}</div>
                <div class="animal-stats">
                    <div class="stat-row">
                        <span class="stat-label">JUMP</span>
                        <div class="stat-bar-bg">
                            <div class="stat-bar-fill" style="width: ${e.stats.jumpForce/35*100}%"></div>
                        </div>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">SPD</span>
                        <div class="stat-bar-bg">
                            <div class="stat-bar-fill" style="width: ${e.stats.chargeSpeed/3*100}%"></div>
                        </div>
                    </div>
                </div>
                <div class="animal-price ${t?"owned":s?"":"locked"}">
                    ${t?i?"EQUIPADO":"USAR":`ðŸ’§ ${e.price}`}
                </div>
            `;const r=()=>this.handleAnimalClick(e);a.addEventListener("click",r),a.addEventListener("touchstart",n=>{n.preventDefault(),r()},{passive:!1}),this.shopGrid.appendChild(a)})}handleAnimalClick(e){this.unlockedAnimals.includes(e.id)?(this.equippedAnimal=e.id,localStorage.setItem("equippedAnimal",this.equippedAnimal),this.updateShopUI()):this.wallet>=e.price&&(this.wallet-=e.price,this.unlockedAnimals.push(e.id),this.equippedAnimal=e.id,localStorage.setItem("walletDrops",this.wallet),localStorage.setItem("unlockedAnimals",JSON.stringify(this.unlockedAnimals)),localStorage.setItem("equippedAnimal",this.equippedAnimal),this.game.soundManager.playCollect(),this.updateShopUI())}draw(e){}handleClick(e,t){}handleMouseMove(e,t){}}class ee{constructor(e){this.game=e}draw(e,t,i,s){if(this.game.difficulty!=="assisted"||!t.grounded&&!t.bulletTime||s<=0)return;const a=t.stats;let n=Math.min(s*a.chargeSpeed,b.MAX_CHARGE)/b.MAX_CHARGE;n=Math.pow(n,.8);const l=b.MIN_JUMP_POWER,c=a.jumpForce,p=l+(c-l)*n;let h,f;i!==0?(h=i*p*a.jumpAngleX,f=-p*b.JUMP_Y_RATIO):(h=0,f=-p*1.2);let m=t.x+t.width/2,g=t.y+t.height/2,S=h,w=f;const u=[],L=100;for(let d=0;d<L&&(u.push({x:m,y:g}),S*=M.AIR_RESISTANCE,w+=M.GRAVITY*a.gravity,w>M.TERMINAL_VELOCITY&&(w=M.TERMINAL_VELOCITY),m+=S,g+=w,m<t.width/2&&(m=t.width/2,S*=-.5,u.push({x:m,y:g,bounce:!0})),m>this.game.width-t.width/2&&(m=this.game.width-t.width/2,S*=-.5,u.push({x:m,y:g,bounce:!0})),!(g>this.game.height+100));d++)if(w>0){for(const P of this.game.world.platforms)if(P.active&&m>P.x&&m<P.x+P.width&&g>P.y-10&&g<P.y+P.height){u.push({x:m,y:g,landing:!0}),d=L;break}}if(u.length>1){e.save(),e.strokeStyle="#000000",e.lineWidth=6,e.setLineDash([8,8]),e.globalAlpha=.8,e.beginPath(),e.moveTo(u[0].x,u[0].y);for(let d=1;d<u.length;d++)e.lineTo(u[d].x,u[d].y);e.stroke(),e.strokeStyle="#FFFFFF",e.lineWidth=4,e.setLineDash([8,8]),e.shadowBlur=15,e.shadowColor="#FFFFFF",e.globalAlpha=1,e.beginPath(),e.moveTo(u[0].x,u[0].y);for(let d=1;d<u.length;d++)e.lineTo(u[d].x,u[d].y);e.stroke(),e.setLineDash([]);for(let d=0;d<u.length;d+=5)e.beginPath(),e.arc(u[d].x,u[d].y,3,0,Math.PI*2),e.fillStyle="#00ffcc",e.fill();for(const d of u)d.bounce&&(e.beginPath(),e.arc(d.x,d.y,6,0,Math.PI*2),e.strokeStyle="#ffff00",e.lineWidth=2,e.stroke(),e.fillStyle="rgba(255, 255, 0, 0.3)",e.fill()),d.landing&&(e.beginPath(),e.arc(d.x,d.y,8,0,Math.PI*2),e.strokeStyle="#00ff00",e.lineWidth=2,e.stroke(),e.fillStyle="rgba(0, 255, 0, 0.3)",e.fill());e.restore()}}}class te{constructor(){this.ctx=new(window.AudioContext||window.webkitAudioContext),this.masterGain=this.ctx.createGain(),this.masterGain.connect(this.ctx.destination),this.masterGain.gain.value=.3,this.muted=!1}toggleMute(){return this.muted=!this.muted,this.masterGain.gain.value=this.muted?0:.3,this.muted}startMusic(){}stopMusic(){}resumeContext(){this.ctx.state==="suspended"&&this.ctx.resume()}playJump(){if(this.muted)return;this.resumeContext();const e=this.ctx.createOscillator(),t=this.ctx.createGain();e.connect(t),t.connect(this.masterGain),e.type="square",e.frequency.setValueAtTime(150,this.ctx.currentTime),e.frequency.exponentialRampToValueAtTime(600,this.ctx.currentTime+.1),t.gain.setValueAtTime(.5,this.ctx.currentTime),t.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+.1),e.start(),e.stop(this.ctx.currentTime+.1)}playLand(){this.muted||this.resumeContext()}playBounce(){if(this.muted)return;this.resumeContext();const e=this.ctx.createOscillator(),t=this.ctx.createGain();e.connect(t),t.connect(this.masterGain),e.type="triangle",e.frequency.setValueAtTime(200,this.ctx.currentTime),e.frequency.linearRampToValueAtTime(600,this.ctx.currentTime+.3),t.gain.setValueAtTime(.5,this.ctx.currentTime),t.gain.linearRampToValueAtTime(.01,this.ctx.currentTime+.3),e.start(),e.stop(this.ctx.currentTime+.3)}playIce(){this.muted||this.resumeContext()}playCollect(){if(this.muted)return;this.resumeContext();const e=this.ctx.createOscillator(),t=this.ctx.createGain();e.connect(t),t.connect(this.masterGain),e.type="sine",e.frequency.setValueAtTime(1e3,this.ctx.currentTime),e.frequency.exponentialRampToValueAtTime(2e3,this.ctx.currentTime+.1),t.gain.setValueAtTime(.3,this.ctx.currentTime),t.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+.15),e.start(),e.stop(this.ctx.currentTime+.15)}playExplosion(){if(this.muted)return;this.resumeContext();const e=this.ctx.sampleRate*.5,t=this.ctx.createBuffer(1,e,this.ctx.sampleRate),i=t.getChannelData(0);for(let r=0;r<e;r++)i[r]=Math.random()*2-1;const s=this.ctx.createBufferSource();s.buffer=t;const a=this.ctx.createGain();a.gain.setValueAtTime(.5,this.ctx.currentTime),a.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+.5),s.connect(a),a.connect(this.masterGain),s.start()}playMilestone(){if(this.muted)return;this.resumeContext();const e=this.ctx.currentTime;[523.25,659.25,783.99,1046.5].forEach((i,s)=>{const a=this.ctx.createOscillator(),r=this.ctx.createGain();a.connect(r),r.connect(this.masterGain),a.type="sine",a.frequency.value=i,r.gain.setValueAtTime(.3,e+s*.1),r.gain.exponentialRampToValueAtTime(.01,e+s*.1+.3),a.start(e+s*.1),a.stop(e+s*.1+.3)})}}class ie{constructor(e){this.game=e,this.particles=[];const t=60;for(let i=0;i<t;i++)this.particles.push(this.createParticle())}createParticle(){return{x:Math.random()*this.game.width,y:Math.random()*this.game.height,size:Math.random()*3+1,speedX:(Math.random()-.5)*.5,speedY:(Math.random()-.5)*.5,alpha:Math.random()*.5+.1,phase:Math.random()*Math.PI*2}}update(e){this.particles.forEach(t=>{t.phase+=.02*e,t.y+=(t.speedY+Math.sin(t.phase)*.2)*e,t.x+=(t.speedX+Math.cos(t.phase)*.2)*e,t.y>this.game.height&&(t.y=0),t.y<0&&(t.y=this.game.height),t.x>this.game.width&&(t.x=0),t.x<0&&(t.x=this.game.width)})}draw(e){const t=Math.max(0,Math.floor((this.game.height-this.game.player.y-this.game.player.height)/10));let i=A[0],s=A[0],a=0;for(let c=0;c<A.length;c++)if(t>=A[c].height)if(i=A[c],c<A.length-1){s=A[c+1];const p=s.height-i.height;a=(t-i.height)/p,a=Math.min(Math.max(a,0),1)}else s=i,a=0;const r=this.lerpColor(i.colorTop,s.colorTop,a),n=this.lerpColor(i.colorBottom,s.colorBottom,a),l=e.createLinearGradient(0,0,0,this.game.height);l.addColorStop(0,r),l.addColorStop(1,n),e.fillStyle=l,e.fillRect(0,0,this.game.width,this.game.height),this.particles.forEach(c=>{const p=c.alpha*(.6+Math.sin(c.phase)*.4);e.fillStyle=`rgba(255, 255, 255, ${p})`,e.beginPath(),e.arc(c.x,c.y,c.size,0,Math.PI*2),e.fill()})}lerpColor(e,t,i){const s=parseInt(e.replace(/#/g,""),16),a=s>>16,r=s>>8&255,n=s&255,l=parseInt(t.replace(/#/g,""),16),c=l>>16,p=l>>8&255,h=l&255,f=a+i*(c-a),m=r+i*(p-r),g=n+i*(h-n);return"#"+((1<<24)+(f<<16)+(m<<8)+(g|0)).toString(16).slice(1)}}class se{constructor(e){this.canvas=e,this.ctx=e.getContext("2d"),this.width=window.innerWidth,this.height=window.innerHeight,this.canvas.width=this.width,this.canvas.height=this.height,this.input=new Z,this.menu=new z(this),this.background=new ie(this),this.camera=new _(this),this.particles=new Q(this),this.trajectoryPreview=new ee(this),this.soundManager=new te,this.world=new D(this),this.player=new U(this),this.difficulty="extreme",this.gameStarted=!1,this.lastTime=0,this.highScore=0,this.collectedCount=0,this.milestonesReached=[],this.milestones=[100,250,500,1e3,5e3,1e4],this.tutorialStep=0,this.gameWon=!1,this.floatingTexts=[];const t=document.getElementById("back-button");if(t){const s=t.cloneNode(!0);t.parentNode.replaceChild(s,t);const a=r=>{r.preventDefault(),r.stopPropagation(),this.resetGame()};s.addEventListener("click",a),s.addEventListener("touchstart",a,{passive:!1})}const i=document.getElementById("mute-button");if(i){const s=a=>{a.preventDefault(),a.stopPropagation();const r=this.soundManager.toggleMute();i.innerText=r?"ðŸ”‡":"ðŸ”Š"};i.addEventListener("click",s),i.addEventListener("touchstart",s,{passive:!1})}this.canvas.addEventListener("click",s=>{const a=this.canvas.getBoundingClientRect(),r=s.clientX-a.left,n=s.clientY-a.top;this.menu.active&&this.menu.handleClick(r,n)}),this.canvas.addEventListener("mousemove",s=>{const a=this.canvas.getBoundingClientRect(),r=s.clientX-a.left,n=s.clientY-a.top;this.menu.active&&this.menu.handleMouseMove(r,n)}),this.canvas.addEventListener("touchstart",s=>{if(this.menu.active){const a=this.canvas.getBoundingClientRect(),r=s.changedTouches[0],n=r.clientX-a.left,l=r.clientY-a.top;this.menu.handleClick(n,l)}},{passive:!1}),window.addEventListener("resize",()=>{this.width=window.innerWidth,this.height=window.innerHeight,this.canvas.width=this.width,this.canvas.height=this.height})}continueGame(e){this.difficulty=e,this.gameStarted=!0,this.tutorialStep=0;const t=localStorage.getItem(`highScore_${this.difficulty}`);if(this.highScore=t?parseInt(t):0,this.updateHighScoreUI(),!this.loadGame()){this.startNewGame(e);return}this.setupGameUI()}startNewGame(e){this.difficulty=e,this.gameStarted=!0,localStorage.getItem("tutorialCompleted")?this.tutorialStep=0:this.tutorialStep=1,localStorage.removeItem(`gameState_${this.difficulty}`);const t=localStorage.getItem(`highScore_${this.difficulty}`);this.highScore=t?parseInt(t):0,this.collectedCount=0,this.updateHighScoreUI(),this.updateScoreUI(),this.world=new D(this),this.player=new U(this),this.camera=new _(this),this.setupGameUI()}setupGameUI(){this.menu.hideAll();const e=document.getElementById("back-button");e&&(e.style.display="block");const t=document.getElementById("score-container");t&&(t.style.display="flex");const i=document.getElementById("controls-hint");i&&(i.style.display="block",i.innerText="Hold Left/Right/Center to Charge Jump | Pink Platforms = Bullet Time âš¡"),this.milestonesReached=[],this.saveInterval&&clearInterval(this.saveInterval),this.saveInterval=setInterval(()=>this.saveGame(),2e3)}resetGame(){this.gameStarted&&this.saveGame(),this.gameStarted=!1,this.saveInterval&&clearInterval(this.saveInterval);const e=document.getElementById("back-button");e&&(e.style.display="none");const t=document.getElementById("score-container");t&&(t.style.display="none");const i=document.getElementById("controls-hint");i&&(i.style.display="none");const s=document.getElementById("milestone-notification");s&&(s.style.display="none");const a=document.getElementById("score");a&&(a.innerText="Height: 0m");const r=document.getElementById("drops-score");r&&(r.innerText="ðŸ’§ 0");const n=document.getElementById("high-score");n&&(n.innerText="Record: 0m"),this.menu.showScreen("main")}saveGame(){if(!this.gameStarted||this.menu.active)return;const e={player:{x:this.player.x,y:this.player.y,vx:this.player.vx,vy:this.player.vy},camera:{y:this.camera.y},world:{highestPoint:this.world.highestPoint,platforms:this.world.platforms.map(t=>({x:t.x,y:t.y,width:t.width,height:t.height,type:t.type,active:t.active,timer:t.timer,respawnTimer:t.respawnTimer})),collectibles:this.world.collectibles.map(t=>({x:t.x,y:t.y,active:t.active}))},collectedCount:this.collectedCount,timestamp:Date.now()};try{localStorage.setItem(`gameState_${this.difficulty}`,JSON.stringify(e))}catch(t){console.error("Failed to save game",t)}}loadGame(){const e=localStorage.getItem(`gameState_${this.difficulty}`);if(!e)return!1;try{const t=JSON.parse(e);return this.world=new D(this),this.world.highestPoint=t.world.highestPoint,this.world.platforms=t.world.platforms,t.world.collectibles&&(this.world.collectibles=t.world.collectibles.map(i=>{const s=new $(i.x,i.y);return s.active=i.active,s})),this.collectedCount=t.collectedCount||0,this.updateScoreUI(),this.player=new U(this),this.player.x=t.player.x,this.player.y=t.player.y,this.player.vx=t.player.vx,this.player.vy=t.player.vy,this.camera=new _(this),this.camera.y=t.camera.y,!0}catch(t){return console.error("Failed to load game",t),!1}}updateHighScoreUI(){const e=document.getElementById("high-score");e&&(e.innerText=`Record: ${this.highScore}m`)}updateScoreUI(){const e=document.getElementById("drops-score");e&&(e.innerText=`ðŸ’§ ${this.collectedCount}`)}showMilestoneNotification(e,t){const i=document.getElementById("milestone-notification");if(i){i.innerText=`ðŸ† ${e}m Reached!
+${t} ðŸ’§`,i.style.display="block",this.soundManager.playMilestone(),i.style.animation="none",i.offsetHeight,i.style.animation="popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)",this.milestoneTimeout&&clearTimeout(this.milestoneTimeout),this.milestoneTimeout=setTimeout(()=>{i.style.display="none"},3e3);for(let s=0;s<30;s++)this.particles.spawn(this.player.x+Math.random()*this.player.width,this.player.y+Math.random()*this.player.height,"#ffd700",15)}}showComboPopup(e,t,i){this.floatingTexts.push({text:`${e}x Combo!`,x:t+15,y:i-20,life:1,vy:-2,color:"#ffcc00",scale:Math.min(1+e*.2,2)})}start(){this.lastTime=performance.now(),requestAnimationFrame(e=>this.loop(e))}loop(e){try{const t=(e-this.lastTime)/16.66;this.lastTime=e,this.update(t),this.draw(),requestAnimationFrame(i=>this.loop(i))}catch(t){console.error("Game Loop Error:",t);const i=document.createElement("div");i.style.position="absolute",i.style.top="0",i.style.left="0",i.style.color="red",i.style.background="rgba(0,0,0,0.8)",i.style.padding="20px",i.style.zIndex="9999",i.innerText=`Error: ${t.message}
${t.stack}`,document.body.appendChild(i)}}checkCollision(e,t){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y}update(e){if(this.player&&this.player.bulletTime&&(e*=.5),!this.menu.active&&this.gameStarted){this.player.update(e),this.particles.update(),this.camera.update(),this.world.update(),this.tutorialStep>0&&this.updateTutorial();for(let s=this.floatingTexts.length-1;s>=0;s--){const a=this.floatingTexts[s];a.y+=a.vy,a.life-=.02,a.life<=0&&this.floatingTexts.splice(s,1)}const t=Math.max(0,Math.floor((this.height-this.player.y-this.player.height)/10)),i=document.getElementById("score");i&&(i.innerText=`Height: ${t}m`),this.world.collectibles.forEach(s=>{if(s.active&&this.checkCollision(this.player,s)){s.active=!1;const a=this.player.comboCount||1,r=1*a;this.collectedCount+=r;let n=parseInt(localStorage.getItem("walletDrops")||"0");n+=r,localStorage.setItem("walletDrops",n),this.soundManager.playCollect(),this.updateScoreUI(),a>1&&this.showComboPopup(`+${r}ðŸ’§`,s.x,s.y)}});for(const s of this.milestones)if(t>=s&&!this.milestonesReached.includes(s)){this.milestonesReached.push(s);const a=Math.floor(s*.2);this.collectedCount+=a;let r=parseInt(localStorage.getItem("walletDrops")||"0");r+=a,localStorage.setItem("walletDrops",r),this.showMilestoneNotification(s,a),this.updateScoreUI()}t>this.highScore&&(this.highScore=t,localStorage.setItem(`highScore_${this.difficulty}`,this.highScore),this.updateHighScoreUI()),t>=1e4&&!this.gameWon&&(this.gameWon=!0,this.showVictoryScreen())}this.background.update(e),this.input.update()}updateTutorial(){const e=document.getElementById("controls-hint");e&&(this.tutorialStep===1?(e.innerText="Hold Left/Right/Center to Charge Jump",this.player.y<this.height-200&&(this.tutorialStep=2)):this.tutorialStep===2&&(e.innerText="Collect Water Drops ðŸ’§ to restore the world!",this.collectedCount>0&&(this.tutorialStep=3,setTimeout(()=>{e.style.display="none",localStorage.setItem("tutorialCompleted","true"),this.tutorialStep=0},3e3))))}draw(){if(this.ctx.clearRect(0,0,this.width,this.height),this.background.draw(this.ctx,this.collectedCount),this.ctx.save(),this.ctx.translate(0,-this.camera.y),this.world.draw(this.ctx),this.player.draw(this.ctx),this.difficulty==="assisted"&&this.input.isCharging&&!this.player.jumpCancelled){let e=0,t=0;this.input.keys.ArrowLeft.pressed?(e=-1,t=this.input.getCharge("ArrowLeft")):this.input.keys.ArrowRight.pressed?(e=1,t=this.input.getCharge("ArrowRight")):this.input.keys.ArrowUp.pressed&&(e=0,t=this.input.getCharge("ArrowUp")),this.trajectoryPreview.draw(this.ctx,this.player,e,t)}this.particles.draw(this.ctx);for(const e of this.floatingTexts)this.ctx.save(),this.ctx.globalAlpha=e.life,this.ctx.fillStyle=e.color,this.ctx.font=`bold ${20*e.scale}px Arial`,this.ctx.shadowBlur=5,this.ctx.shadowColor="#000",this.ctx.fillText(e.text,e.x,e.y),this.ctx.restore();if(this.ctx.restore(),this.gameStarted&&Math.abs(this.world.wind)>.1){const e=this.world.wind,t=this.width-60,i=120;this.ctx.save(),this.ctx.translate(t,i),this.ctx.fillStyle="rgba(255, 255, 255, 0.8)",this.ctx.font="bold 16px monospace",this.ctx.textAlign="center",this.ctx.shadowBlur=5,this.ctx.shadowColor="#000";const s=e>0?"ðŸ’¨ >>>":"<<< ðŸ’¨";this.ctx.globalAlpha=.3+Math.abs(e)*.7,this.ctx.fillText(s,0,0),this.ctx.restore()}}showVictoryScreen(){this.menu.showVictory(),this.soundManager.playCollect()}}var R;(function(o){o.Unimplemented="UNIMPLEMENTED",o.Unavailable="UNAVAILABLE"})(R||(R={}));class G extends Error{constructor(e,t,i){super(e),this.message=e,this.code=t,this.data=i}}const ae=o=>{var e,t;return o?.androidBridge?"android":!((t=(e=o?.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||t===void 0)&&t.bridge?"ios":"web"},re=o=>{const e=o.CapacitorCustomPlatform||null,t=o.Capacitor||{},i=t.Plugins=t.Plugins||{},s=()=>e!==null?e.name:ae(o),a=()=>s()!=="web",r=h=>{const f=c.get(h);return!!(f?.platforms.has(s())||n(h))},n=h=>{var f;return(f=t.PluginHeaders)===null||f===void 0?void 0:f.find(m=>m.name===h)},l=h=>o.console.error(h),c=new Map,p=(h,f={})=>{const m=c.get(h);if(m)return console.warn(`Capacitor plugin "${h}" already registered. Cannot register plugins twice.`),m.proxy;const g=s(),S=n(h);let w;const u=async()=>(!w&&g in f?w=typeof f[g]=="function"?w=await f[g]():w=f[g]:e!==null&&!w&&"web"in f&&(w=typeof f.web=="function"?w=await f.web():w=f.web),w),L=(y,v)=>{var I,C;if(S){const E=S?.methods.find(T=>v===T.name);if(E)return E.rtype==="promise"?T=>t.nativePromise(h,v.toString(),T):(T,F)=>t.nativeCallback(h,v.toString(),T,F);if(y)return(I=y[v])===null||I===void 0?void 0:I.bind(y)}else{if(y)return(C=y[v])===null||C===void 0?void 0:C.bind(y);throw new G(`"${h}" plugin is not implemented on ${g}`,R.Unimplemented)}},d=y=>{let v;const I=(...C)=>{const E=u().then(T=>{const F=L(T,y);if(F){const j=F(...C);return v=j?.remove,j}else throw new G(`"${h}.${y}()" is not implemented on ${g}`,R.Unimplemented)});return y==="addListener"&&(E.remove=async()=>v()),E};return I.toString=()=>`${y.toString()}() { [capacitor code] }`,Object.defineProperty(I,"name",{value:y,writable:!1,configurable:!1}),I},P=d("addListener"),q=d("removeListener"),x=(y,v)=>{const I=P({eventName:y},v),C=async()=>{const T=await I;q({eventName:y,callbackId:T},v)},E=new Promise(T=>I.then(()=>T({remove:C})));return E.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await C()},E},O=new Proxy({},{get(y,v){switch(v){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return S?x:P;case"removeListener":return q;default:return d(v)}}});return i[h]=O,c.set(h,{name:h,proxy:O,platforms:new Set([...Object.keys(f),...S?[g]:[]])}),O};return t.convertFileSrc||(t.convertFileSrc=h=>h),t.getPlatform=s,t.handleError=l,t.isNativePlatform=a,t.isPluginAvailable=r,t.registerPlugin=p,t.Exception=G,t.DEBUG=!!t.DEBUG,t.isLoggingEnabled=!!t.isLoggingEnabled,t},oe=o=>o.Capacitor=re(o),B=oe(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),H=B.registerPlugin;class K{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,t){let i=!1;this.listeners[e]||(this.listeners[e]=[],i=!0),this.listeners[e].push(t);const a=this.windowListeners[e];a&&!a.registered&&this.addWindowListener(a),i&&this.sendRetainedArgumentsForEvent(e);const r=async()=>this.removeListener(e,t);return Promise.resolve({remove:r})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,i){const s=this.listeners[e];if(!s){if(i){let a=this.retainedEventArguments[e];a||(a=[]),a.push(t),this.retainedEventArguments[e]=a}return}s.forEach(a=>a(t))}hasListeners(e){var t;return!!(!((t=this.listeners[e])===null||t===void 0)&&t.length)}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:i=>{this.notifyListeners(t,i)}}}unimplemented(e="not implemented"){return new B.Exception(e,R.Unimplemented)}unavailable(e="not available"){return new B.Exception(e,R.Unavailable)}async removeListener(e,t){const i=this.listeners[e];if(!i)return;const s=i.indexOf(t);this.listeners[e].splice(s,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach(i=>{this.notifyListeners(e,i)}))}}const V=o=>encodeURIComponent(o).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),N=o=>o.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class ne extends K{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach(i=>{if(i.length<=0)return;let[s,a]=i.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");s=N(s).trim(),a=N(a).trim(),t[s]=a}),t}async setCookie(e){try{const t=V(e.key),i=V(e.value),s=`; expires=${(e.expires||"").replace("expires=","")}`,a=(e.path||"/").replace("path=",""),r=e.url!=null&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${i||""}${s}; path=${a}; ${r};`}catch(t){return Promise.reject(t)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(t){return Promise.reject(t)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}H("CapacitorCookies",{web:()=>new ne});const le=async o=>new Promise((e,t)=>{const i=new FileReader;i.onload=()=>{const s=i.result;e(s.indexOf(",")>=0?s.split(",")[1]:s)},i.onerror=s=>t(s),i.readAsDataURL(o)}),he=(o={})=>{const e=Object.keys(o);return Object.keys(o).map(s=>s.toLocaleLowerCase()).reduce((s,a,r)=>(s[a]=o[e[r]],s),{})},ce=(o,e=!0)=>o?Object.entries(o).reduce((i,s)=>{const[a,r]=s;let n,l;return Array.isArray(r)?(l="",r.forEach(c=>{n=e?encodeURIComponent(c):c,l+=`${a}=${n}&`}),l.slice(0,-1)):(n=e?encodeURIComponent(r):r,l=`${a}=${n}`),`${i}&${l}`},"").substr(1):null,de=(o,e={})=>{const t=Object.assign({method:o.method||"GET",headers:o.headers},e),s=he(o.headers)["content-type"]||"";if(typeof o.data=="string")t.body=o.data;else if(s.includes("application/x-www-form-urlencoded")){const a=new URLSearchParams;for(const[r,n]of Object.entries(o.data||{}))a.set(r,n);t.body=a.toString()}else if(s.includes("multipart/form-data")||o.data instanceof FormData){const a=new FormData;if(o.data instanceof FormData)o.data.forEach((n,l)=>{a.append(l,n)});else for(const n of Object.keys(o.data))a.append(n,o.data[n]);t.body=a;const r=new Headers(t.headers);r.delete("content-type"),t.headers=r}else(s.includes("application/json")||typeof o.data=="object")&&(t.body=JSON.stringify(o.data));return t};class fe extends K{async request(e){const t=de(e,e.webFetchExtra),i=ce(e.params,e.shouldEncodeUrlParams),s=i?`${e.url}?${i}`:e.url,a=await fetch(s,t),r=a.headers.get("content-type")||"";let{responseType:n="text"}=a.ok?e:{};r.includes("application/json")&&(n="json");let l,c;switch(n){case"arraybuffer":case"blob":c=await a.blob(),l=await le(c);break;case"json":l=await a.json();break;case"document":case"text":default:l=await a.text()}const p={};return a.headers.forEach((h,f)=>{p[f]=h}),{data:l,headers:p,status:a.status,url:a.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}H("CapacitorHttp",{web:()=>new fe});var X;(function(o){o.Dark="DARK",o.Light="LIGHT",o.Default="DEFAULT"})(X||(X={}));var Y;(function(o){o.None="NONE",o.Slide="SLIDE",o.Fade="FADE"})(Y||(Y={}));const J=H("StatusBar");B.isNativePlatform()&&(J.hide().catch(console.log),J.setOverlaysWebView({overlay:!0}).catch(console.log));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(o=>console.log("Service Worker registered")).catch(o=>console.log("Service Worker registration failed:",o))});const ue=document.getElementById("gameCanvas"),me=new se(ue);me.start();
